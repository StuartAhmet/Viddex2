<%# projects with thumbnail %>
<% if @project.background_id?
    text_box_width = @project.background.width
    text_box_height = @project.background.text_box_height
    text_box_x = @project.background.x_axis
    text_box_y = @project.background.y_axis
    project_angle = @project.background.angle

# projects without backgrounds
   else
     text_box_width = @project.videos[0].text_width
     text_box_height = @project.videos[0].text_box_height
     text_box_x = @project.videos[0].x_axis
     text_box_y = @project.videos[0].y_axis
     project_angle = @project.videos[0].angle
     underlay_params = nil
  end%>

<% if @project.background_id && @project.background.text_distortion == true
      distortion_params = "#{@project.background.distort_nw_x}:#{@project.background.distort_nw_y}:#{@project.background.distort_ne_x}:#{@project.background.distort_ne_y}:#{@project.background.distort_se_x}:#{@project.background.distort_se_y}:#{@project.background.distort_sw_x}:#{@project.background.distort_sw_x}:"
    # elsif @project.video.text_distortion == true
    #   distortion_params = "#{@project.video.distort_nw_x}:#{@project.video.distort_nw_y}:#{@project.video.distort_ne_x}:#{@project.video.distort_ne_y}:#{@project.video.distort_se_x}:#{@project.video.distort_se_y}:#{@project.video.distort_sw_x}:#{@project.video.distort_sw_x}:"
    else
      distortion_params = nil
  end%>

<% if @project.message_body?
  message_params = {angle: project_angle,
                    distort: distortion_params,
                    gravity: "north_west",
                    :overlay=>{
                      font_family: @project.font,
                      font_size: @project.font_size,
                      text: @project.message_body},
                      opacity: @project.opacity,
                      width: text_box_width,
                      height: text_box_height,
                      x: text_box_x,
                      y: text_box_y,
                      crop: "fit",
                      }
  else
  message_params = nil
  end%>
<div class="thumbnail-image">
  <%= cl_image_tag(@project.thumbnail_key+'.gif',
    resource_type: "video",
    controls: false,
    preload: "metadata",
    width: "100%",
    poster: false,
    effect: "loop:5",
    :transformation=>[
      # {:width=>1280, audio_codec: audio_codec_params, end_offset: "2", :quality=>"auto", :crop=>"scale"},
      # message params
      message_params,
        # overlay play btn
        {:overlay=>"play-button-icon-png-18919_ssamfy", :opacity=>60, :width=>200, :crop=>"scale"},
        ])
  %>

  <p style="color: white;background-color: black;padding-left: 8px; margin-bottom: 0;"><%= @project.title %> (opens in new window)</p>
  </div>

  <button style="width:100%;margin:5px 0px;"><i class="bi bi-clipboard mr10"></i>Copy to clipboard</button>
  <div class="flex space-between">
    <button style="width:100%"><i class="bi bi-binoculars mr10"></i> View</button>
    <button style="width:100%"><i class="bi bi-trash mr10"></i>Delete</button>
   </div>
