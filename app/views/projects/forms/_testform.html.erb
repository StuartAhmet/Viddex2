<div style="overflow:auto">
  <div class="ts-grid-container">
    <div class="template-grid">
      <div class="template-summary">
        <h3><%= @selected_template.title %></h3>
      </div>
    </div>
    <div class="video-sequence-box" data-controller="slideshow">
      <div data-controller="new-project-form">
        <%= simple_form_for [@user, @project] do |f| %>

          <div data-slideshow-target="slide">
            <% video_count = 1 %>
            <% @selected_template.template_videos.count.times do %>
              <div class="flex space-between">
                <div class="mr20 mb20 mw-50">
                  <p><strong>Video <%= video_count %> : </strong>
                  <%= @selected_template.template_videos[video_count-1].title %></p>
                  <%= @selected_template.template_videos[video_count-1].video_instructions %>
                  <br>
                </div>
                <!-- Modal button -->
                <button type="button" class="btn_hover agency_banner_btn video_select"
                  id="thumbnail-button<%=video_count%>" data-bs-toggle="modal"
                  data-bs-target="#popupModal<%=video_count%>">
                    Select video
                </button>
                <!-- Modal -->
                <div class="modal fade" id="popupModal<%=video_count%>" tabindex="-1" aria-labelledby="popupModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="popupModalLabel">Select a video</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body flex space-between wrap">
                          <% @user.videos.each do |video| %>
                            <div>
                              <!--  <ul class="thumbnail_select " onClick="choosevid<%=video_count%>(this)" data-bs-dismiss="modal" data-value="<%=video.id %>" id="<%=video.title%>">-->
                            <ul class="thumbnail_select " onClick="chooseVideo(<%=video_count%>, this)" data-bs-dismiss="modal" data-value="<%=video.id %>" id="<%=video.title%>">
                                <img src="<%= video.service_url%>", id="thumbnail-<%= video.id %>", class="thumbnails"><br />
                                <%= video.title %>
                              </ul>
                            </div>
                          <% end %>
                      <%= f.association :videos, as: :hidden, collection: @selectedVideos, input_html: { id: "selected_video#{video_count}", multiple: true}%>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                      </div>
                    </div>
                  </div>
                </div>
                <%# end of modal %>
              </div>
              <% video_count += 1 %>
            <% end %><!--end of loop -->
            <div style="text-align:end">
              <button type="button" class="btn_get btn_hover" data-action="slideshow#next"> Next </button>
            </div>
          </div>

          <div data-slideshow-target="slide">
            <% index = 0 %>
            <% @selected_template.template_videos.count.times do %>
               <% if @selected_template.template_videos[index].message?%>
                <div class="flex space-between">
                  <p>Video <%= index+1 %> Message</p>
                  <%= f.input :message_body, label: false,
                  placeholder: @selected_template.template_videos[0].message_instructions %>
                </div>
              <% end %>
              <% index +=1 %>
            <% end %>
            <div class="flex space-between">
              <p>Font type</p>
              <button type="button" id="font-select-btn"class="flex space-between form-control" data-bs-toggle="modal" data-bs-target="#fontModal">
                Permanent Marker
                <i class="bi bi-chevron-down"></i>
              </button><br>
            </div>
            <%# Modal for font %>
             <div class="modal fade" id="fontModal" tabindex="-1" aria-labelledby="fontModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="fontModalLabel">Select your font</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <% font_number = 0 %>
                      <% Project::FONT.each do %>
                        <ul onClick="choosefont(this)" data-bs-dismiss="modal" data-value="<%=Project::FONT[font_number] %>">
                          <button type="button" class="btn-font"id="fontType<%= Project::FONT[font_number] %>">
                            <h4 style="font-family:<%= Project::FONT[font_number] %>"><%= Project::FONT[font_number] %></h4>
                          </button>
                        </ul>
                        <% font_number +=1 %>
                      <% end %>
                      <%= f.input :font, as: :hidden, collection: @selectedFont, input_html: { id: "selected_font", multiple: false} %>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>
            <%# end of model for font %>
            <div class="flex space-between">
              <p>Font size</p>
              <%= f.input :font_size, label: false %>
            </div>

              <div class="flex space-between">
                <button type="button" class="btn_get btn_hover" data-action="slideshow#previous"> Back </button>
                <button type="button" class="btn_get btn_hover" data-action="slideshow#next"> Next </button>
              </div>
          </div>

          <div data-slideshow-target="slide">
            <% @selected_template.count_template_videos_with_image.times do %>
              <%= f.association :backgrounds %>
            <% end %>
              <% if @selected_template.audio_required? %>
                <%= f.association :audios %>
              <% end %>
              <div class="flex space-between">
                <button type="button" class="btn_get btn_hover" data-action="slideshow#previous"> Back </button>
                <button type="button" class="btn_get btn_hover" data-action="slideshow#next"> Next </button>
              </div>
          </div>

          <div data-slideshow-target="slide">
              <%= f.input :title %>
              <%= f.input :prospect_first %>
              <%= f.input :prospect_email %>
              <%= f.input :prospect_company %>
              <%= f.input :include_meeting_link %>
              <div class="flex space-between">
                <button type="button" class="btn_get btn_hover" data-action="slideshow#previous"> Back </button>
                <%= f.submit class: "btn_get btn_hover"%>
              </div>
          </div>

          <%= f.association :templates, collection: @templates, as: :hidden, input_html: { value: @selected_template&.id, multiple: true} %>

        <% end %>
      </div>
    </div>
  </div>
</div>



<script>
  // video selection
  var selectedVideos = [];

  var buttons = [];

  for (var i = 1; i <= 3; i++) {
    buttons.push(document.getElementById("thumbnail-button" + i));
  }

  function chooseVideo(index, element) {
    var videoId = element.dataset.value;
    document.getElementById("selected_video" + index).value = videoId;
    buttons[index -1].innerHTML = element.innerText.trim();
    buttons[index -1].classList.replace("agency_banner_btn", "btn_get");
    selectedVideos[index -1] = videoId;
  }
  // font selection
   var selectedFont = ""

  function choosefont(element) {
    var fontId = element.dataset.value;
    var fontbtn = document.getElementById("font-select-btn")
    document.getElementById("selected_font").value = fontId;
    fontbtn.innerHTML = element.innerText.trim() + "<i class='bi bi-chevron-down'></i>";
    selectedFont = fontId;
  }



</script>
